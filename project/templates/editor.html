{% extends "base.html" %}

{% block content %}
<style>
  .itemlist {
    position: relative;
    display: flex;
    align-items: center;
    margin: 20px 0;
    cursor: pointer;
  }
  .itemlist::before {
    content: "";
    position: absolute;
    top: 0px;
    left: 0;
    width: 45px;
    height: 45px;
    border-radius: 22.5px;
    background: #1f83f2;
    box-shadow: 5px 5px 7px rgba(0, 0, 0, 0.25), inset 2px 2px 5px rgba(255, 255, 255, 0.25), inset -3px -3px 5px rgba(0, 0, 0, 0.5);
    transition: all 0.5s;
  }
  .itemlist:hover::before {
    width: 100%;
  }
  .itemlist .rank {
    position: relative;
    min-width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
  }
  .itemlist .rank::before {
    content: "";
    width: 30px;
    height: 30px;
    position: absolute;
    background-color: #2f363e;
    border-radius: 30px;
    transform: scale(0);
    transition: 0.5s;
  }
  .itemlist .rank span {
    position: relative;
    font-weight: 600;
    font-size: 1em;
    color: #fff;
    transition: all 0.5s;
  }
  .itemlist:hover .rank::before {
    transform: scale(1);
  }
  .itemlist .creator {
    position: relative;
    line-height: 1.15em;
  }
  .itemlist .creator h4 {
    font-weight: 800;
    color: #fff;
    transition: 0.5s;
  }
  .itemlist .creator p {
    font-weight: 400;
    color: #000;
    font-size: 0.85em;
    transition: 0.5s;
  }
  .itemlist:hover .creator p {
    color: #fff;
  }
</style>

<div style="min-height:100vh">
  <h1 class="title">
    Flask based integration editor
  </h1>
  <h2 class="subtitle">
    Create and make your integration code here.
  </h2>

  <div class="is-widescreen">
    <div class="columns">
      <aside class="menu column has-text-left">
        <p class="menu-label">
          My Works
        </p>
        <ul id="tabs" class="menu-list">
          <li id="newScript"><a style="color:black">New Script</a></li>
          <li id="allScript"><a style="color:black">All Scripts</a></li>
          <li id="scriptGroups"><a style="color:black">Script Groups</a></li>
        </ul>
      </aside>
      <div class="column is-four-fifths">
        <div id="tab-view-holder" class="is-large">
          <div id="newScript">
            <form method="POST" action="/editor">        
              <div class="field">
                <div class="control">
                  <input class="input is-large" name="name" placeholder="Script Name" autofocus >
                </div>
              </div>
            
              <div class="field">
                <div class="control">
                  <input class="input is-large" name="description" placeholder="Description">
                </div>
              </div>

              <div class="field">
                <div class="control">
                    <textarea name="scriptarea" class="textarea" placeholder="Just paste your python script here."></textarea>
                </div>
              </div>
              <button class="button is-block is-info is-large is-fullwidth">Upload Script</button>
            </form>
          </div>
          <div id="allScript">
            <section class="has-text-left">
            </section>
          </div>
          <div id="scriptGroups">
            The script groups
          </div>
        </div>
      </div>
    </div>
  </div> 
<div>

<script>

  /***********************************************************************/
  /***************** Manage Tabs and TabView STARTS here *****************/
  /***********************************************************************/

  var tabs = document.getElementById("tabs")
  var tabView = document.getElementById("tab-view-holder")
  let currentView = null

  showOnlyTheViewByIndex(0)
  Array.prototype.forEach.call(tabs.children,(tab,i)=>{
    tab.onclick = function(){
      showTabViewById(tab.id)
      switch(tab.id){
        case "allScript":
          if (scriptList.length == 0 )
            getScriptsList();
          break;
        case "scriptGroups":
          console.error('Load the script groups')
          break;
      }
    };
  })

  // fetch all store all the scripts list in frontend
  // don't fetch again if it done once
  var scriptList = []

  function showSavedScripts(){
    section = currentView.getElementsByTagName('section')[0]

    // Add each and every fetched scripts into the section
    scriptList.forEach((s,i)=>{  
      var item = document.createElement("div");
      item.innerHTML = `<div class="itemlist">
        <div class="rank"><span>${i+1}</span></div>
        <div class="creator">
          <h4>${s.name}</h4>
          <p>${s.date.$date}</p>
        </div>
      </div>`

      section.appendChild(item)
    })    
  }

  


  /***********************************************************************/
  /****************** Manage Tabs and TabView ENDS here ******************/
  /***********************************************************************/


  /***********************************************************************/
  /******************** Utility functions STARTS here ********************/
  /***********************************************************************/

  function showOnlyTheViewByIndex(index){
    // Hide all the views first
    Array.prototype.forEach.call(tabView.children, (e,i)=>{
      e.classList.add("is-hidden");
    })
    // Now its the time to show only the view corresponding to the selected index
    tabView.children[index].classList.toggle("is-hidden");
  }

  function showTabViewById(id){
    // Hide all the views first
    Array.prototype.forEach.call(tabView.children, (e,i)=>{
      e.classList.add("is-hidden");
    })

    // find the corresponding tabView with the provided id
    currentView = [...tabView.children].find((tv)=>tv.id == id)
    // Now toggle the "is-hidden" class for the currentView
    if(currentView == null){
      console.error("Hey, there is no dom element present with id '"+ id + "'")
    }else{
      currentView.classList.toggle("is-hidden");
    }
  }

  async function getScriptsList(){
    scriptList = await fetch('/list')
    .then(response => response.json())
    .then(data=>data.myscripts);

    showSavedScripts();
  }
  /***********************************************************************/
  /********************* Utility functions ENDS here *********************/
  /***********************************************************************/
</script>

{% endblock %}